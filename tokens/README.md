# Joe Design System – Tokens

This folder is the **single source of truth** for design token.

Generated output is used by: **Next.js** and **Storybook**, and by **`app/globals.css`**.

## Files

| File | Role |
|------|------|
| `joe-tokens.json` | Source tokens (W3C format). Edited by designers/devs or synced from Figma (e.g. Token Studio). |
| `joe-tokens-legacy.json` | Legacy-format copy for Token Studio sync. Generated by `npm run tokens:build` (and `tokens:legacy`) so Figma Variables show semantics referencing primitives when sync uses Legacy format. Commit this file so designers can sync from it. |
| `output/css/variables.css` | Generated CSS custom properties (DO NOT EDIT THIS!!). |
| `output/tailwind/theme.cjs` | Generated Tailwind theme (DO NOT EDIT THIS!!!). |

Generated files are produced by `npm run tokens:build` (see `scripts/build-tokens.mjs`). The build also generates `joe-tokens-legacy.json` for Figma/Token Studio.

## Recommended approach: Figma + Storybook in sync

**Goals:** Storybook keeps working, tokens stay in sync with Figma, designers use tokens in Figma without manually adding variables, and primitives + semantic variables are added to Figma **only** through Token Studio’s export (with semantics referencing primitives in the Variables panel, like your working example).

### Why Do We Have joe-tokens.json And joe-tokens-legacy.json

- **Single source of truth:** `joe-tokens.json` (W3C). Build produces CSS, Tailwind theme, **and** `joe-tokens-legacy.json`.
- **Storybook:** Uses `tokens/output/` from `tokens:build`; no dependency on Legacy.
- **Figma / designers:** Token Studio syncs from **`tokens/joe-tokens-legacy.json`**. In Token Studio, set **Token format to Legacy** for this sync. **Pull** from repo → **Export to Figma** (Variables, and Styles if needed). Primitives and semantic variables are created only via this export; semantics reference primitives in the Variables panel (same behavior as your working example).
- **Sync:** After any change to `joe-tokens.json`, run **`npm run tokens:build`** (or `tokens:watch` then `tokens:build` once). That updates `output/` and `joe-tokens-legacy.json`. Commit both; designers pull and re-export to Figma. No manual variable creation in Figma.

### Designer workflow (Figma)

1. Open Token Studio in Figma; connect sync to the repo (or the branch that contains `tokens/joe-tokens-legacy.json`).
2. Point the sync at **`tokens/joe-tokens-legacy.json`** (path relative to repo root). Set **Token format** to **Legacy** for this provider.
3. **Pull** to get latest tokens.
4. **Export to Figma:** Styles & Variables → export **Variables** (and **Styles** if desired). Check **primitives** and **semantic**. Export. Primitives and semantic variables are created in Figma; semantics reference primitives in the Variables panel.
5. Use the Variables (and Styles) in Figma for design. When tokens change in the repo, pull and export again.

## Token structure (required for the pipeline)

The build script expects this shape so it can resolve references and generate CSS + Tailwind:

1. **Top-level groups**: `primitives` and `semantic`.
2. **Token format**: Each token is an object with a value and type. **Both formats are supported:**
   - **Legacy (Token Studio default):** `value` and `type` (e.g. `"value": "#FFFFFF"`, `"type": "color"`).
   - **W3C DTCG:** `$value` and `$type` (e.g. `"$value": "#FFFFFF"`, `"$type": "color"`).
   You can convert to W3C in Token Studio (“Convert to W3C DTCG format”); the pipeline accepts both.
3. **References**: Use `{primitives.colors.white}` or `{primitives.space.m}` so semantic tokens point at primitives. References are resolved at build time.

Example:

```json
{
  "primitives": {
    "colors": {
      "white": { "value": "#FFFFFF", "type": "color" }
    },
    "space": {
      "m": { "value": "1rem", "type": "spacing" }
    }
  },
  "semantic": {
    "color": {
      "background": {
        "default": { "value": "{primitives.colors.white}", "type": "color" }
      }
    }
  }
}
```

## Token Studio (Figma) alignment

If you use the **Token Studio** plugin in Figma:

1. **Sync target**: Point the plugin’s sync path at **`tokens/joe-tokens-legacy.json`** (path relative to repo). Set **Token format** to **Legacy** for this sync provider. Then Export to Figma so primitives and semantic variables are created via the plugin (semantics referencing primitives in the Variables panel).
2. **Structure**: Configure the plugin so the exported JSON has:
   - Root keys: `primitives` and `semantic` (or map your groups to these names in a post-step).
   - Each token as `{ "value": "...", "type": "..." }`.
   - References in the form `{primitives.xxx.yyy}`.
3. **If the plugin uses another format** (e.g. W3C design tokens): keep `joe-tokens.json` as the source of truth in the repo and either:
   - Change the plugin’s output format to match the structure above, or
   - Add a small conversion script that transforms the plugin’s export into `joe-tokens.json` before running `tokens:build`.

After any change to `joe-tokens.json`, run **`npm run tokens:build`** and commit the generated files; see **Recommended approach** above.

### Troubleshooting

If semantics don't reference primitives in the Variables panel (or styles appear empty), ensure you're syncing from **`tokens/joe-tokens-legacy.json`** with **Token format = Legacy**, and that **primitives** and **semantic** are both checked when you Export to Figma. See **Recommended approach** and **Designer workflow** above.

### Light / dark mode (when you extend tokens)

When you add themes, use **Token Studio Themes (Pro)** and **Export to Figma from Themes** so the variable collection gets modes (e.g. Light, Dark). Variables and styles will then switch with the mode. You can also add a second mode to the collection in Figma and set values manually.

## Extending the token set

- **Primitives**: Add under `primitives` (e.g. `primitives.colors`, `primitives.space`, `primitives.radii`, `primitives.fontSizes`). The build script already maps these to CSS variables and Tailwind theme.
- **Semantic**: Add under `semantic.color` (or other semantic groups the script supports). Prefer referencing primitives, e.g. `"value": "{primitives.colors.blue.500}"`.
- **New categories**: If you add new top-level sections (e.g. `semantic.shadow`), you may need to extend `scripts/build-tokens.mjs` to emit CSS and/or Tailwind for them.

The current set covers: **Button** (primary, secondary, outline, ghost, destructive, icon), and the semantic color/space/typography/radius tokens used by the UI components and `app/globals.css`. It can be extended for Input, Card, Badge, Alert, etc. as needed.

